<!DOCTYPE html>
<html lang="en-US" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="-1">

        <title>6 Little Lines of Fail - Everything is Distributed | Reflective Tech Consulting For Succesful Projects</title>
        <meta name="title" content="6 Little Lines of Fail - Everything is Distributed | Reflective Tech Consulting For Succesful Projects">
        <meta name="description" content="Helping others with useful content | posts, development, developers, junior-developers, management, teamlead, techlead, architecture, advanced SOA, CTO, Fractional, Fractional CTO, CTO as a Service, Leadership, Technical Leadership, Fractional Leadership, Affordable Tech Leadership, Affordable Technical Leadership, Strategy, Strategic Leadership, Consultation, Tech Consultation, Technical Consultation, Health Check, Precision Tech Audit, Due Diligence Code Audit, Outsourcing, Nearshoring, Offshoring, Vendor Management, Team Management, Team Mentoring, Entrepreneurs, CEOs, Founders, SMEs, Startups, Software Engineering, Boring Companies, Boring Technology, MVP, Minimum Viable Project, Procuct Market Fit, Software Architecture, Software Development, Tech Debt, Technical Debt, Programming Debt, Best Practices, Simple Approach, Near-to-zero Maintenance, SimplyPut Consulting">
        <meta name="keywords" content="posts, development, developers, junior-developers, management, teamlead, techlead, architecture, advanced SOA, CTO, Fractional, Fractional CTO, CTO as a Service, Leadership, Technical Leadership, Fractional Leadership, Affordable Tech Leadership, Affordable Technical Leadership, Strategy, Strategic Leadership, Consultation, Tech Consultation, Technical Consultation, Health Check, Precision Tech Audit, Due Diligence Code Audit, Outsourcing, Nearshoring, Offshoring, Vendor Management, Team Management, Team Mentoring, Entrepreneurs, CEOs, Founders, SMEs, Startups, Software Engineering, Boring Companies, Boring Technology, MVP, Minimum Viable Project, Procuct Market Fit, Software Architecture, Software Development, Tech Debt, Technical Debt, Programming Debt, Best Practices, Simple Approach, Near-to-zero Maintenance, SimplyPut Consulting">
        <meta name="author" content="Balázs HIDEGHÉTY">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://reflectivetechconsulting.com//post/6-little-lines-of-fail-everything-is-distributed/">
        <link rel="shortcut icon" type="image/png" href="/assets/reflection logo.ico">
        
        <link rel="preconnect" href="cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="cdnjs.cloudflare.com">

        <link rel="preconnect" href="cdn.jsdelivr.net">
        <link rel="dns-prefetch" href="cdn.jsdelivr.net">

        <script src="/assets/js/custom/set-environment.js"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha256-MBffSnbbXwHCuZtgPYiwMQbfE7z+GOZ7fBPCNB06Z98=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha256-gvZPYrsDwbwYJLD5yeBfcNujPhRoGOY831wwbIzz3t0=" crossorigin="anonymous"></script>

        <script src="/assets/js/custom/clipboard-copy.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/ejs@3.1.6/ejs.min.js" integrity="sha256-mOsgtygNfXBUPc/+cc19yr+g0jieqYOgRL5xFD2sC0Y=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js" integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" integrity="sha512-PEsccDx9jqX6Dh4wZDCnWMaIO3gAaU0j46W//sSqQhUQxky6/eHZyeB3NrXD2xsyugAKd4KPiDANkcuoEa2JuA==" crossorigin="anonymous"></script>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <link rel="stylesheet" href="/assets/css/main.css" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax.css" integrity="sha256-/a0I9OFWuIXZRhqSuqIj8g0NUYSID+mwuyOuuFZb12A=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax.min.js" integrity="sha256-uCknJLYMrtYTPwl8PwQnFj6T6Hck2oSGEZLhMi1BRvU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax-video.min.js" integrity="sha256-zYuE44YyKYv3Y4xv38UkxBY4jFCzAmAxwJ2nfRj16WI=" crossorigin="anonymous"></script>
        <script>
            function InitParallax() {
                jarallax(document.querySelectorAll('.jarallax'), {
                    speed: 0.2, 
                    disableVideo: /iPad|iPhone|iPod|Android/
                });
            }
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js" integrity="sha512-3J8teBiHrSyaaRBajZyIEtpDsXdPq1gsznKWIVb5CnorQuFhjWGhWe54z8YNnHHr7MZuExb9m5kvf964HiT1Sw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            function InitTyped() {
                // sample:
                // <span class="text-success">ever created for
                //   <span data-typed='{"strings": ["developers.", "founders.", "designers."]}'></span>
                //   <span class="typed-cursor typed-cursor--blink" aria-hidden="true">|</span>
                // </span>
                document.querySelectorAll("[data-typed]").forEach(e => {
                    const t = {
                        typeSpeed: 40,
                        backSpeed: 10,
                        backDelay: 2e3,
                        loop: true,
                        replaceBaseText : true, /* future feature */
                        autoInsertCss: true,
                        ...e.dataset.typed ? JSON.parse(e.dataset.typed) : {}
                    };

                    var typed = new Typed(e, t);
                });
            }         
        </script>

        
        <script src="https://cdn.jsdelivr.net/npm/wowjs@1.1.3/dist/wow.min.js" integrity="sha256-gHiUEskgBO+3ccSDRM+c5+nEwTGp64R99KYPfITpnuo=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" crossorigin="anonymous">
        <script>
            function InitAOS() {
                new WOW({ animateClass: 'animate__animated' }).init();
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js"></script>
        <script>
            function InitCounters() {
                new PureCounter();
            }
        </script>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.2.0/dist/css/glightbox.min.css" integrity="sha256-bT9i1NF5afnHDpQ4z2cQBHJQGehoEj8uvClaAG+NXS0=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/glightbox@3.2.0/dist/js/glightbox.min.js" integrity="sha256-A9/h+86SqfF/zRoVASE72CDQUKsIXDOEGasGo2MclFk=" crossorigin="anonymous"></script>
        <script>
            function InitLightbox() {
                GLightbox({});
            }
        </script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.4/dist/tiny-slider.css">
        <script src="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.4/dist/min/tiny-slider.min.js"></script>
        <style>
        
            .tns-nav {
                text-align: center;
                margin: 1em 0;
            }

            .tns-nav > [aria-controls] {
                width: .5em;
                height: .5em;
                padding: 0;
                margin: .5em .25em;                
                border: 0;
                border-radius: 50%;
                background: var(--bs-gray);
            }

            .tns-nav > .tns-nav-active { 
                background: var(--bs-gray-dark); 
            }

        </style>
        <!--
        Possibilities:
        - bootstrap carousel (1 item visible)
        - css carousel https://codepen.io/medrupaloscil/pen/OJNrLLX
        - vanilla JS: keen-slider, swiper, tiny-slider, glider
        - jQuery carousel: slick-carousel, glidejs
        -->
        <script>
            function InitCarousel(selector, options) {
                var carousel = tns({
                    container: selector,
                    ...options
                });
            }
        </script>
        
        
    </head>
    <body class="fit-height">

        <!-- cookie consent script -->
        <!--
NOTE:
    ConsentStatus.enabled is set if no cookie consent is required (globals.cookieConsent.required)...
    ...otherwise ConsentStatus.default is the default value until consent is not given or denied!
-->
<script>
    const CookieConsent = {

        StatusEnum: {
            "default": "default",
            "enabled": "enabled",
            "disabled": "disabled"
        },

        loadScripts: function (requireConsent, consentUrl) {
            if (requireConsent) {
                // scripts managed based on consent status
                this._initializeCookieConsent(consentUrl);
            } else {
                // all scripts enabled
                this._enableCookies();
            }
        },

        getStatus() {
            return localStorage.cookies ?? this.StatusEnum.default;
        },

        _setStatus(value) {
            const changed = this.getStatus() != value;
            localStorage.cookies = value;
            if (changed) window.location.reload();
        },

        _defaultCookies: function () {
            console.log('default cookies');
            this._setStatus(this.StatusEnum.default);
        },

        _enableCookies: function () {
            console.log('enabled cookies');
            this._setStatus(this.StatusEnum.enabled);
        },

        _disableCookies: function () {
            console.log('disabled cookies');
            this._setStatus(this.StatusEnum.disabled);
        },

        _initializeCookieConsent: function (consentUrl) {

            const me = this;

            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#aa0000",
                        "text": "#ffdddd"
                    },
                    "button": {
                        "background": "#ff0000"
                    }
                },
                "theme": "edgeless",
                "position": "bottom-right",
                "type": "opt-in",
                "content": {
                    "message": "This website uses cookies to ensure you get the best experience here.",
                    "href": consentUrl
                },

                onInitialise: function (status) {
                    console.log(`cc - onInitialise, status: ${status}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    
                    if (type == 'opt-in' && didConsent) {
                        me._enableCookies();
                    }
                    else if (type == 'opt-out' && !didConsent) {
                        me._disableCookies();
                    }
                    else {
                        me._defaultCookies();
                    }
                },

                onStatusChange: function (status, chosenBefore) {
                    console.log(`cc - onStatusChange, status: ${status}, chosenBefore: ${chosenBefore}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();

                    if (type == 'opt-in' && didConsent) {
                        me._enableCookies();
                    }
                    if (type == 'opt-out' && !didConsent) {
                        me._disableCookies();
                    }
                },

                onRevokeChoice: function () {
                    // NOTE: this hook is called immediately after the revoke button is clicked and removes previous answers
                    console.log(`cc - onRevokeChoice`);

                    var type = this.options.type;

                    if (type == 'opt-in') {
                        me._disableCookies();

                        // NOTE: we need to reload page, so that we get rid of the loaded GA / Disqus scripts!
                        location.reload();
                    }
                    if (type == 'opt-out') {
                        me._enableCookies();
                    }
                },

                onPopupOpen: function () {
                    console.log(`cc - onPopupOpen`);
                },

                onPopupClose: function () {
                    console.log(`cc - onPopupClose`);
                }

            });

        }

    };
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>
<script>
    const requireConsent = JSON.parse('true');
    const consentUrl = '/cookies.html';  
    CookieConsent.loadScripts(requireConsent, consentUrl);
</script>


        <header class="sticky-top">
            <nav id="navbar-main" class="navbar-main navbar navbar-expand-lg">

    <div class="container">

        <a class="navbar-brand d-flex align-items-center" href="/">
            <div class="d-flex flex-column">
                <img src="/assets/reflection logo.png" />
                <span class="navbar-brand-subtitle align-self-center">ReflectiveTechConsulting.Com</span>
            </div>
        </a>

        <div class="ms-auto mx-2"></div>

        <!-- standalone search bar activator (below navigation) -->
        <a type="button" role="button" class="btn border-0 me-2 d-lg-none"
            data-bs-toggle="collapse" data-bs-target="#blog-search-bar">
            <!-- d-sm-none = hide if above sm -->
            <i class="fa-solid fa-magnifying-glass"></i>
        </a>

        <button type="button" class="btn navbar-toggler"
            data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <!-- Using navbar-toggler fix in main.scss and FA icons instead of: <span class="navbar-toggler-icon"></span> -->
            <i class="fa-solid fa-bars"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarNavDropdown">

            <ul class="navbar-nav d-flex flex-row flex-wrap align-items-center bd-navbar-nav pt-2 py-sm-0 px-5 w-100">
               
                
                <!--
    The navigation menu should always use CURRENT www version links (for this there's no _v* segment) !
-->
<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link default p-2" href="/"><i class="fa-solid fa-house"></i></a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/services">Services</a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/projects">Projects & More</i></a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/fcto">F-CTO</a>
</li>

<!--
<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/about-me">About Me</a>
</li>
-->

                <div class="ms-auto mx-2"></div>

                <li class="nav-item dropdown col-12 col-lg-auto">
                    <hr class="d-block d-lg-none" />
                    <a class="d-inline-flex nav-link p-2" href="/posts/1/">Posts</a>
                    <a class="d-inline-flex nav-link no-dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-hover="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-angles-down"></i>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" href="/tags">Tags</a></li>
                        <li><a class="dropdown-item" href="/categories">Categories</a></li>
                        <li><a class="dropdown-item" href="/series">Series</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/tag-cloud">Tags cloud</a></li>
                    </ul>
                </li>      

            </ul>

        </div>

        <!-- inline search-bar with same expand breakpoint as navigation -->
        <nav class="nav-search d-none d-lg-inline">
            <!-- hidden by def., visible (block) aft. size SM -->
            <div class="inline-input-group inline-text-right">
                <span class="inline-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" class="blog-search-input form-control py-0" placeholder="Search...">
            </div>
        </nav>

    </div>

</nav>

<!-- 
standalone search bar (below navigation) with same breakpoint as navigation (shown on collapse)
d-sm-none = hide if above sm
-->
<nav class="nav-search-below d-lg-none collapse" id="blog-search-bar">
    <div class="container">
        <div class="p-3">
            <div class="inline-input-group inline-text-left">
                <span class="inline-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" class="blog-search-input form-control" placeholder="Search...">
            </div>
        </div>
    </div>
</nav>
        </header>

        <main>
            
            

    <div class="layout layout-post">
     
        <div class="content-container container">

            <div class="hide-if-search-results-container-is-displayed row">

                <section class="article-section col-12 col-xl-9 overflow-hidden">
               
                    <header></header>
                    <article>
                        

    
    
    
    <section class="d-flex justify-content-end align-items-center d-hide-if-empty">
        

<section class="share-wrapper">
    <span class="share-label text-body-secondary mr-1">Share post</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/6-little-lines-of-fail-everything-is-distributed/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fa-brands fa-linkedin fa-fw"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Share post&amp;url=/post/6-little-lines-of-fail-everything-is-distributed/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fa-brands fa-square-twitter fa-fw"></i>
                </a>
            
        
            
        
            
        
            
        
        
        <a href onclick="copyLink(); return false;" data-toggle="tooltip" data-placement="top" title="Copy link">
            <i class="fa-solid fa-link fa-fw small"></i>
        </a>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>


    </section>
    
    <section class="article print-container">

        <section>
            <h1>6 Little Lines of Fail - Everything is Distributed</h1>
            
            <p>This article is part of the serie: <a href="/serie/distributed-systems">distributed-systems</a></p>
            
            
        </section>
    
        <section class="taxonomy small d-xl-flex gap-3 pb-3">
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/categories"><i class="fa-regular fa-fw fa-folder-open text-body-secondary"></i></a>
    </div>
    <div class="d-inline-block">
        
        
        <a href="/category/newsletter/1/" class="me-1">
                
            Newsletter
            
        </a>
        
        
        <a href="/category/newsletter/architecture/1/" class="me-1">
                
            Newsletter
                
             - Architecture
            
        </a>
        
        
        <a href="/category/development/architecture/1/" class="me-1">
                
            Development
                
             - Architecture
            
        </a>
        
    </div>
</div>

<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/tags"><i class="fa-solid fa-fw fa-tags text-body-secondary"></i></a>
    </div>
    <div class="d-inline-block">
        
        <a href="/tag/posts/1/" class="me-1">posts</a>
        
        <a href="/tag/development/1/" class="me-1">development</a>
        
        <a href="/tag/developers/1/" class="me-1">developers</a>
        
        <a href="/tag/junior-developers/1/" class="me-1">junior-developers</a>
        
        <a href="/tag/management/1/" class="me-1">management</a>
        
        <a href="/tag/teamlead/1/" class="me-1">teamlead</a>
        
        <a href="/tag/techlead/1/" class="me-1">techlead</a>
        
        <a href="/tag/architecture/1/" class="me-1">architecture</a>
        
        <a href="/tag/advanced-soa/1/" class="me-1">advanced SOA</a>
        
    </div>
</div>
</section>

        <section class="small pb-3">
            <div><span class="text-body-secondary">Posted</span> Feb 05, 2024</div>
            <div class="d-xl-flex justify-content-start gap-3">
                <div><span class="text-body-secondary">By</span> Balázs HIDEGHÉTY</div>
                <div class="ms-auto">6 min <span class="text-body-secondary">reading time</span></div>
            </div>
        </section>

        <hr class="m-1" />

        <section class="pb-3">
            <img class="img-thumbnail img-this d-block mx-auto float-md-start me-md-3 mb-md-1" src="/post/6-little-lines-of-fail-everything-is-distributed/6 little lines of fail.png">
            <p>In today’s tech-driven world, <span class="text-highlight">even the simplest-looking code can wreak havoc if not handled by seasoned experts</span>. This’s why technical experts are not just “nice to have” for companies, but a crucial lifeline.</p>
<p><strong>TimeoutException - Probably, this is one of the trickiest errors of all because, sometimes, it’s not even an error!</strong></p>
<div class="clearfix"></div>
<hr/>
<p>Today’s “lesson” is for <a href="https://www.linkedin.com/feed/hashtag/?keywords=management" target="_blank" class="text-decoration-none"><i class="fa-solid fa-hashtag"></i>management</a>.</p>
<p>It’s short and simple.</p>
<p><strong>Your company engages in distributed computing, whether it realizes it or not…</strong></p>
<p>…just as your company is a tech company, whether you realize it or not (you depend on technology, you use it to fuel your business).</p>
<p><strong>So you need technical experts more desperately than you’d ever admit to yourself.</strong></p>
<p>Because…</p>
<blockquote>
<p>FAILURE IS ALWAYS AN OPTION!</p>
</blockquote>
<hr>
<h2 id="intro" tabindex="-1">Intro</h2>
<p><strong>Distributed computing is not easy.</strong></p>
<p>How difficult is it?</p>
<p>Well…</p>
<p>Here are six lines of code;</p>
<p>Nicely written;</p>
<p>Easy to read;</p>
<p>They are perfect;</p>
<p>– yet…</p>
<p>…with distributed computing, disaster awaits under the hood.</p>
<ul>
<li><strong>Don’t let hidden disasters sabotage your company’s success.</strong></li>
<li><strong>Embrace the power of technical expertise.</strong></li>
<li><strong>Minimize failures</strong> - by ensuring that at least two pairs of eyes are always on your code (yes, two seniors are better than one).</li>
</ul>
<p>That’s it.
(That’s my message!)</p>
<p><span class="fw-bold">Regarding the content below:</span> I suggest to check out at least the summary to <span class="text-highlight">see what kind of business related decisions building a software requires</span> - for that, scroll there via <a href="#the-business-part">this</a> link.</p>
<p>–</p>
<p>The linked video (and its summary) is primarily intended for <a href="https://www.linkedin.com/feed/hashtag/?keywords=developers" target="_blank" class="text-decoration-none"><i class="fa-solid fa-hashtag"></i>developers</a> and curious <a href="https://www.linkedin.com/feed/hashtag/?keywords=managers" target="_blank" class="text-decoration-none"><i class="fa-solid fa-hashtag"></i>managers</a>. Both audiences need to grasp that <strong>technical decisions are shaped by business requirements</strong>, emphasizing the crucial role of effective communication.</p>
<p>–</p>
<p>📌 So here it is: <a href="https://www.youtube.com/watch?v=VvUdvte1V3s&amp;t=217s">Six Little Lines of Fail - Jimmy Bogard - YouTube</a></p>
<h2 id="6-little-lines-of-fail---summary" tabindex="-1">6 Little Lines of Fail - Summary</h2>
<h3 id="5-potential-points-of-failure" tabindex="-1">5 Potential Points of Failure</h3>
<p>The problem with the provided code is: <span class="text-highlight">missing failure handling</span></p>
<p><span class="fw-bold">There are five potential points of failure:</span></p>
<ol>
<li><strong>When the call to the database (order placement) fails:</strong> The system displays an error message, but it remains consistent (although no error is good after credit card information has been entered into the system)!</li>
<li><strong>When the call to Stripe fails:</strong>
<ul>
<li><strong>Timeout error:</strong> The payment may have been processed successfully (money withdrawn), but the user receives a timeout exception. Probably, this is one of the trickiest errors of all because, sometimes, it’s not even an error!</li>
<li><strong>On other errors:</strong> The system remains at least consistent.</li>
</ul>
</li>
<li><strong>When SendGrid fails:</strong> With Stripe already succeeding and the transaction being rolled back, the user is billed for nothing. (The customer calls customer service, incurring further costs, and there is no order detail, leading to a poor user experience.)</li>
<li><strong>When RabbitMQ fails:</strong> Similar issues arise as with SendGrid (plus we already told the customer that the payment was successful).</li>
<li><strong>When the transaction fails:</strong> All the issues above occur.</li>
</ol>
<p><span class="text-highlight">So how to avoid them?</span></p>
<p>You don’t!</p>
<p>You can’t!</p>
<p><strong>It’s not a matter of WHETHER something fails, but rather WHEN it does.</strong></p>
<blockquote>
<p>FAILURE IS ALWAYS AN OPTION!</p>
<p>ASSUME FAILURES, PLAN FOR THE WORST!</p>
</blockquote>
<p>–</p>
<p>But good news;</p>
<p>There are 4 options for dealing with failures.</p>
<h3 id="dealing-with-failures-(in-software)" tabindex="-1">Dealing with failures (in software)</h3>
<p>Introducing Gregor Hohpe’s insightful perspectives on handling failures…</p>
<p><span class="fw-bold">There are 4 options for dealing with failures:</span></p>
<ul>
<li><strong>Ignore</strong> failure - For non-critical cases and non occuring failures (like logging failures aren’t critical for the business)</li>
<li><strong>Retry</strong> operation - Can it be retried? How long to retry? How to handle constant failing? Needs a retry policy!</li>
<li><strong>Undo</strong> action (<strong>compensation</strong>) for the succeeded part(s) if other parts fail (or database transaction rollback).</li>
<li><strong>Coordinate: Prepare / Commit phase</strong> - Real-life sample: buying a house via a broker - it comes with a cost (money and/or time overhead).</li>
</ul>
<p>Which one of the four options to choose? It depends mostly on the business, but in some cases, the technical capabilities of the underlying systems might also intervene (reduce options).</p>
<p><img src="/post/6-little-lines-of-fail-everything-is-distributed/6 little lines of fail - 4 options of dealing with failures.png" class="img img-thumbnail"></img></p>
<p>Explore Gregor Hohpe’s valuable insights on handling failures through his compelling works:</p>
<ul>
<li><a href="https://www.enterpriseintegrationpatterns.com/ramblings/18_starbucks.html">Starbucks Does Not Use Two-Phase Commit</a></li>
<li><a href="https://www.amazon.com/gp/product/1492077542">The Software Architect Elevator: Redefining the Architect’s Role in the Digital Enterprise: Hohpe, Gregor: 9781492077541: Amazon.com: Books</a></li>
</ul>
<h3 id="the-master-plan" tabindex="-1">The Master Plan</h3>
<blockquote>
<p>For each external resource, examine possibilities and pick the best option based on business requirements!</p>
</blockquote>
<p><strong>STRIPE</strong></p>
<ul>
<li><strong>Ignore</strong> - We don’t want to ignore a failed payment, we want to fulfill the order (although in real world we might ignore payment problems - like loyal client, small amount, etc.)</li>
<li><strong>Retry</strong> - We need to avoid double charging; we need <strong>idempotency</strong>! Usual cases of double charging can include: <strong>double-click</strong>, timeout issues followed by retries. Google: stripe idempotency (idempotency key or cartId)!</li>
<li><strong>Undo</strong> - Credit vs. refund which is supported by stripe! <strong>But what if refund fails? What if refund timeouts?</strong></li>
<li><strong>Coordinate</strong> - Stripe supports 2 step payment flows (pending transaction)! Authorize and then capture. If capture fails, the Stripe UI allows to do manual retries…</li>
</ul>
<p><strong>SEND GRID</strong></p>
<ul>
<li><strong>Ignore</strong> - Do we want to fail the entire order process if we can’t send a “thank you for your order” email? Here ignore can be a valid option!</li>
<li><strong>Retry</strong> - Sendgrid has no idempotency. The business would like to have exactly one email sent out, but that does not work with distributed systems. So, they have to choose between 0 or 1 email, or at least one (so 1 or more) email(s)!</li>
<li><strong>Undo</strong> - NOT POSSIBLE (Google postpones email sending to allow undo - they wait 10-second before sending an email). We can do business level compensation actions: apology email and providing coupons.</li>
<li><strong>Coordinate</strong> - N/A</li>
</ul>
<p><strong>RabbitMQ (similar to emails)</strong></p>
<ul>
<li><strong>Ignore</strong> - Flag the order and let a <strong>background process</strong> to retry failed messages later on) - <em>SET order.needsOrderCreatedEventRaised = true;</em></li>
<li><strong>Retry</strong> - Azure Service Bus has duplicate message detection within a given time period; others have the concept of retry. However, RabbitMQ does not, so here we need to know how consumers react to duplicate messages. We need to have control there (on the consumer side) or choose another option to deal with the failure.</li>
<li><strong>Undo</strong> - N/A - We can’t unsend the message! Compensating message would be weird! From a business perspective an undo of the order is an option.</li>
<li><strong>Coordinate</strong> - N/A</li>
</ul>
<p><img src="/post/6-little-lines-of-fail-everything-is-distributed/6 little lines of fail - 4 options of dealing with failures - summary.png" class="img img-thumbnail"></img></p>
<h3 id="breaking-the-process-coupling" tabindex="-1">Breaking The Process Coupling</h3>
<blockquote>
<p>We can’t encode all these options directly into the main code!</p>
<p>…too much branching leads to unmaintainable code!</p>
</blockquote>
<p>So we need a different approach!</p>
<p><strong>Can we avoid exceptions by breaking the process coupling?</strong> The answer is: yes, we can! But how is something that the business has to define.</p>
<p>Can we avoid exceptions by breaking the process coupling? The answer is: yes, we can! However, there are many details that the business needs to define.</p>
<h4 id="the-business-part" tabindex="-1">The Business Part</h4>
<p><span class="fw-bold">We need to ask:</span></p>
<ul>
<li><span class="text-highlight">Do we have to execute these steps now, or can we execute them in the future?</span></li>
<li>Is there a specific order in which the steps should be executed?</li>
</ul>
<p><strong>Payment (STRIPE)</strong></p>
<p>Businesses with <strong>finite amount of resources</strong> (movie tickets bound to a seat, reservation timer) might need to charge immediately, while Amazon with <strong>infinite stocks</strong> might allow to charge later (in this case we can utilize a background process for payment and even do easily retries for failed charging).</p>
<p><strong>Notification (SENDGRID)</strong></p>
<p>When to email the user: after placing the order or when the payment goes through? Is it okay to delay the order notification if the payment fails (knowing that we’ll try again)? What if the user thinks the order failed and buys elsewhere? How about sending separate emails for a successful order and payment?</p>
<p>There’s another business decision here regarding retries (mentioned in the previous chapter): In the event of issues, we can’t ensure that exactly one email is sent out. We can have either 0 or 1 email sent (e.g., it’s acceptable if the user does not receive an email at all), or we can ensure at least 1 email being sent (e.g., it’s acceptable if the user occasionally receives duplicate emails).</p>
<p><strong>Fulfilling the order / Order placed event (RABBITMQ)</strong></p>
<p>After placing an order, we inform others to fulfill it.</p>
<p><span class="text-highlight">Have you considered this?</span> Despite having consistent data in our database, clarity only emerges when warehouse personnel check. This is especially true with <strong>finite resources</strong>, particularly when selling the last items. Only by checking the store can we be sure if we’re able to fulfill the order. Consider this as another kind of “eventual” consistency, as issues like loss, theft, damage, direct sale, or processes outside the usual protocol can lead to discrepancies between the real stock count and the database.</p>
<p><span class="fw-bold">IMPORTANT:</span> In messaging systems, when dispatching messages as a part of an atomic operation, it is important to understand and implement the <strong>outbox pattern</strong>.</p>
<h4 id="the-technical-part" tabindex="-1">The Technical Part</h4>
<blockquote>
<p>Modern eCommerce uses background processes to fulfill an order (higher degree of success)!</p>
</blockquote>
<p>For this, we can leverage workflows. Here are some <strong>workflow patterns</strong> to consider:</p>
<ul>
<li>Routing Slip: Linear flow.</li>
<li>Saga Pattern (e.g., booking a holiday with car, hotel, and flight): With compensation, useful for simple scenarios where each step can be executed individually.</li>
<li>Process Manager Pattern: Orchestration, command-based (order matters), or choreography, event-based.</li>
</ul>
<p>There’s another kind of Saga definition that closely aligns with the Process Manager pattern. Check out <a href="https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/saga/saga">Saga pattern - <s>Azure</s> Design Patterns | Microsoft Learn</a> for insights into orchestration and choreography differences, along with their pros and cons.</p>
<h2 id="conclusion" tabindex="-1">Conclusion</h2>
<p>In the dynamic realm of distributed computing, technical expertise is essential to navigate potential pitfalls, as highlighted by the elusive TimeoutException.</p>
<p>This article and the linked video underscores the inevitability of failures and introduces strategies to address them, <strong>emphasizing the need for a tailored approach aligning with business requirements and technical capabilities</strong>. It stresses the <strong>importance of breaking process coupling</strong> and concludes by advocating for the use of workflow patterns to efficiently orchestrate complex processes, highlighting the delicate interplay between business and technology in the digital landscape.</p>
<hr>
<p>📌 Make sure you and your team subscribe (follow me) on <a href="https://www.linkedin.com/in/hideghety/" target="_blank" class="text-decoration-none"><i class="fa-brands fa-linkedin"></i> LinkedIn</a> so you don’t miss out on the latest insights!</p>
<hr>

        </section>

    </section>
     

                    </article>
                    <div class="article-tail">
                        
    
    <hr class="m-1" />

    <section class="further-reading">
        <h5 class="text-body-secondary">Further Reading</h5>
        <div class="post-navigation related-posts dynamic-headings">
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/microservices-communication-and-conversation-patterns/"></a>

		<div class="card-body">

			<div class="card-text post-date">Mar 18, 2024</div>
			<div class="card-title post-title">Microservices Communication and Conversation Patterns</div>
			<div class="card-text post-content">
				<p>This talk is truly impressive!<br>
Let's conduct this business analysis for scaling.<br>
Let's explore what generic lessons the food industry offers for software engineers.<br></p>

			</div>
	
		</div>

	</div>	
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/designing-microservices-the-right-way/"></a>

		<div class="card-body">

			<div class="card-text post-date">Feb 26, 2024</div>
			<div class="card-title post-title">Designing Microservices the Right Way</div>
			<div class="card-text post-content">
				<p><strong>Remember, business goals are rarely about having a top-notch system!</strong></p>
<p>Finally, we have arrived at the point where we can discuss the pinnacle of modern software architecture: <strong>microservices</strong>.</p>

			</div>
	
		</div>

	</div>	
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/simple-api-integration-problems-and-patterns/"></a>

		<div class="card-body">

			<div class="card-text post-date">Feb 19, 2024</div>
			<div class="card-title post-title">Simple API - Integration Problems and Patterns</div>
			<div class="card-text post-content">
				<p>Even the simplest distributed system – <span class="text-highlight">yes, even integrating against a single API – can pose significant challenges</span> (more than 80% of solutions that SMEs have). <strong>Mind-blowing, right!?</strong></p>

			</div>
	
		</div>

	</div>	
    
</div>
        


<section class="post-navigation prev-next">
    <div class="btn-group btn-group-block d-flex">
        <a class="btn btn-sm btn-outline-secondary" prompt="Older" href="/post/distributed-system-design-and-fallacies/" title="Distributed System Design and Fallacies"><div>Distributed System Design and Fallacies</div></a>
        
        <a class="btn btn-sm btn-outline-primary" prompt="Newer" href="/post/unit-testing-101/" title="Unit Testing 101"><div>Unit Testing 101</div></a>
        </div>
</section>

    </section>

    <section class="commenting d-hide-if-empty">
        
        

    </section>


                    </div>
                    <footer></footer>
                </section>

                <section class="aside-section d-none d-xl-flex col-xl-3">
                    <header></header>
                    <aside>

    <div class="sticky-container d-flex flex-column">

        <div non-sticky-heading></div>

        
        <section class="order-0 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Articles in Serie</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><ul class="aside-navigation series">

    <li>
        <a href="/post/designing-microservices-the-right-way/">Designing Microservices the Right Way - distributed-systems</a></li>
    
    <li>
        <a href="/post/simple-api-integration-problems-and-patterns/">Simple API - Integration Problems and Patterns - distributed-systems</a></li>
    
    <li>
        <a href="/post/distributed-system-design-and-fallacies/">Distributed System Design and Fallacies - distributed-systems</a></li>
    
    <li>
        <span class="active">6 Little Lines of Fail - Everything is Distributed - distributed-systems</span>
</ul></div>
</section>

        
        <section class="order-1 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Similar Articles</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><ul class="aside-navigation related-posts">
    
    <li>
        
        <a href="/post/microservices-communication-and-conversation-patterns/">
            <span>Microservices Communication and Conversation Patterns</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/designing-microservices-the-right-way/">
            <span>Designing Microservices the Right Way</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/simple-api-integration-problems-and-patterns/">
            <span>Simple API - Integration Problems and Patterns</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/distributed-system-design-and-fallacies/">
            <span>Distributed System Design and Fallacies</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/domain-driven-design-and-refactoring/">
            <span>Domain Driven Design and Refactoring</span>
        </a>
    </li>
    
</ul></div>
</section>

        
        <section class="order-2 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Recent Posts</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div>
<ul class="recent-posts">
    
    <li>
        <a href="/post/microservices-communication-and-conversation-patterns/">
            <span>Microservices Communication and Conversation Patterns</span>
        </a>
    </li>
    
    <li>
        <a href="/post/designing-microservices-the-right-way/">
            <span>Designing Microservices the Right Way</span>
        </a>
    </li>
    
    <li>
        <a href="/post/simple-api-integration-problems-and-patterns/">
            <span>Simple API - Integration Problems and Patterns</span>
        </a>
    </li>
    
    <li>
        <a href="/post/distributed-system-design-and-fallacies/">
            <span>Distributed System Design and Fallacies</span>
        </a>
    </li>
    
    <li>
        <a href="/post/6-little-lines-of-fail-everything-is-distributed/">
            <span>6 Little Lines of Fail - Everything is Distributed</span>
        </a>
    </li>
    
</ul></div>
</section>

        
        <section class="order-3 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Tag Cloud</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><div class="ps-3">
 
    <span style="font-size: 1.035294117647059em;">
        <a href="/tag/advanced-soa/1/">advanced SOA</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/analysis/1/">analysis</a>
    </span>
 
    <span style="font-size: 1.0941176470588236em;">
        <a href="/tag/architecture/1/">architecture</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/avoid-failures/1/">avoid-failures</a>
    </span>
 
    <span style="font-size: 1.2705882352941176em;">
        <a href="/tag/ceos/1/">CEOs</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/chat/1/">chat</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/classification/1/">classification</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/ctos/1/">CTOs</a>
    </span>
 
    <span style="font-size: 1.3294117647058825em;">
        <a href="/tag/developers/1/">developers</a>
    </span>
 
    <span style="font-size: 1.3294117647058825em;">
        <a href="/tag/development/1/">development</a>
    </span>
 
    <span style="font-size: 1.035294117647059em;">
        <a href="/tag/efficiency/1/">efficiency</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/emails/1/">emails</a>
    </span>
 
    <span style="font-size: 1.211764705882353em;">
        <a href="/tag/entrepreneurship/1/">entrepreneurship</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/founder/1/">founder</a>
    </span>
 
    <span style="font-size: 1.211764705882353em;">
        <a href="/tag/founders/1/">founders</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/hr/1/">HR</a>
    </span>
 
    <span style="font-size: 1.2705882352941176em;">
        <a href="/tag/junior-developers/1/">junior-developers</a>
    </span>
 
    <span style="font-size: 0.9176470588235295em;">
        <a href="/tag/linkedin/1/">linkedIn</a>
    </span>
 
    <span style="font-size: 1.5647058823529412em;">
        <a href="/tag/management/1/">management</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/meetings/1/">meetings</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/microservices/1/">microservices</a>
    </span>
 
    <span style="font-size: 1.8em;">
        <a href="/tag/posts/1/">posts</a>
    </span>
 
    <span style="font-size: 0.9176470588235295em;">
        <a href="/tag/productivity-hacks/1/">productivity-hacks</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/scaling/1/">scaling</a>
    </span>
 
    <span style="font-size: 1.2705882352941176em;">
        <a href="/tag/smes/1/">SMEs</a>
    </span>
 
    <span style="font-size: 0.9176470588235295em;">
        <a href="/tag/softwareengineering/1/">softwareengineering</a>
    </span>
 
    <span style="font-size: 1.2705882352941176em;">
        <a href="/tag/startups/1/">startups</a>
    </span>
 
    <span style="font-size: 0.9176470588235295em;">
        <a href="/tag/team-setup/1/">team-setup</a>
    </span>
 
    <span style="font-size: 1.3294117647058825em;">
        <a href="/tag/teamlead/1/">teamlead</a>
    </span>
 
    <span style="font-size: 1.3294117647058825em;">
        <a href="/tag/techlead/1/">techlead</a>
    </span>
 
    <span style="font-size: 0.9176470588235295em;">
        <a href="/tag/tips/1/">tips</a>
    </span>

</div></div>
</section>

        
        <section class="order-first sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Table of Contents</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><div class="text-nowrap overflow-hidden"><nav class="toc">
                <ol>
                    
                    <li><a href="#intro">Intro</a>
            		</li>

                    <li><a href="#6-little-lines-of-fail---summary">6 Little Lines of Fail - Summary</a>
            
                <ol>
                    
                    <li><a href="#5-potential-points-of-failure">5 Potential Points of Failure</a>
            		</li>

                    <li><a href="#dealing-with-failures-(in-software)">Dealing with failures (in software)</a>
            		</li>

                    <li><a href="#the-master-plan">The Master Plan</a>
            		</li>

                    <li><a href="#breaking-the-process-coupling">Breaking The Process Coupling</a>
            
                <ol>
                    
                    <li><a href="#the-business-part">The Business Part</a>
            		</li>

                    <li><a href="#the-technical-part">The Technical Part</a>
            		</li>
                </ol>
            		</li>
                </ol>
            		</li>

                    <li><a href="#conclusion">Conclusion</a>
            		</li>
                </ol>
            </nav></div></div>
</section>

    </div>

</aside>
                    <footer></footer>
                </section>

            </div>

            <div class="hide-if-search-results-container-is-displayed row">
                <!-- Add tail here? Looks weird if aside content is long! -->
                
            </div>

            <div class="search-results-container row">
                <div class="search-results-wrapper overflow-hidden"></div>
            </div>

        </div>

    </div>


        </main>

	    <!-- dynamic & custom scripts to alter rendered content -->
        <script>

    /* uses:
    EJS.CO for templating
    LUNR for search
    HE for HTML encoding (at highlight fnc.)
    */
   
    class Debouncer {
        _timeoutId = undefined;
        _wait = 250;
        _callback;

        constructor(callback, wait) {
            this._wait = wait ? wait : this._wait;
            this._callback = callback;
        }

        next(...args) {
            this.cancel();
            this._timeoutId = window.setTimeout(() => {
            this._callback.apply(null, args);
            }, this._wait);
        }

        cancel() {
            window.clearTimeout(this._timeoutId);
        }
    }

    const blogSearch = {

        _searchIndexPath: '/search.json',
        _urlPrefix: '/',
        _debounceTime: 400,

        _searchingTemplate: `
<h2>
    <i class="fa-solid fa-circle-notch fa-spin text-secondary"></i>
    <span class="text-secondary">Searching for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>
`,

        _resultTemplate_simple: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<% if (searchResults.length == 0){ %>
    <span class="no-results">We're sorry, but we couldn't find any items that match your search. Please try again with different keywords or filters...</span>
<% } %>

<ul class="items-found">
<% searchResults.forEach((sr, idx, arr) => { %>
    <li>
        <div class="search-result-item position-relative border shadow">
            <h5><%- sr.ref.title %></h5>
            <p class="x-text-nowrap x-text-truncate"><%- sr.ref.summary %></p>
            <a href="<%- urlPrefix %><%- sr.ref.url %>" class="stretched-link"></a>
        </div>
    </li>
<% }); %>
</ul>        
`,

        _resultTemplate: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<% if (searchResults.length == 0){ %>
    <span class="no-results">We're sorry, but we couldn't find any items that match your search. Please try again with different keywords or filters...</span>
<% } %>

<ul class="search-results">
<% searchResults.forEach((sr, idx, arr) => { %>
    <li>

        <div class="catalogue-item position-relative">
            
            <a class="stretched-link" href="<%- urlPrefix %><%- sr.ref.url %>"></a>
            <h3 class="catalogue-title"><%- sr.ref.title %></h3>
            <div class="catalogue-line"></div>

            <div class="catalogue-preview clearfix">
                <% if (sr.ref.image) { %>
                <img src="<%- sr.ref.image %>" class="catalogue-image img-fluid img-thumbnail"></img>
                <% } %>
                <div class="excerpt">
                    <%- sr.ref.summary %>
                </div>
            </div>

        </div>

    </li>
<% }); %>
</ul>        
`,

        _inputElements: [],
        _cancelElements: [],
        
        _updateInputs(value) {
            this._inputElements.forEach(el => el.value = value);
        },

        _setUpListeners(inputSelector, cancelSelector) {
            if (inputSelector) {
                this._inputElements = document.querySelectorAll(inputSelector);
                this._inputElements.forEach(el => el.addEventListener('keyup', evt => { if (evt.keyCode == 27) this._escapePressed(el); else this._inputValueChanged(el); } ));
            } else {
                this._inputElements = [];
            }

            if (cancelSelector) {
                this._cancelElements = document.querySelectorAll(cancelSelector);
            } else {
                this._cancelElements = [];
            }
        },

        _escapePressed(el) {
            this.clearSearch();
        },

        _inputValueChanged(el) {
            const value = el.value;
            this._updateInputs(value);
            this._debouncedSearch.next(value);
        },

        _resultContainerEls: [],
        _containersToHideEls: [],

        _setUpContainers(resultContainerSelector, containersToHideWhenResultSelector) {
            this._resultContainerEls = document.querySelectorAll(resultContainerSelector);
            this._containersToHideEls = document.querySelectorAll(containersToHideWhenResultSelector);
        },

        _showResults: false,
        _searching: false,
        _searchText: '',
        _searchResults: [],

        refreshUi() {
            const self = this;

            self._inputElements.forEach(el => el.value = self._searchText );

            const html = self._showResults
                ? self._searching
                    ? ejs.render(self._searchingTemplate, { searchText: self._searchText })
                    : ejs.render(self._resultTemplate, { urlPrefix: self._urlPrefix.replace(/\/+$/, ''), searchText: self._searchText, searchResults: self._searchResults })
                : '';

            self._resultContainerEls.forEach(el => { 
                // hide/show container
                self._showResults ? el.classList.remove("d-none") : el.classList.add("d-none")
                
                // find results element (or fallback to container) and set results
                const resultsEl = el.querySelector(".search-results-wrapper");
                const displayEl = resultsEl ?? el;
                displayEl.innerHTML = self._showResults ? html : "";
            });

            self._containersToHideEls.forEach(el => self._showResults ? el.classList.add("d-none") : el.classList.remove("d-none"));          
        },

        clearSearch() {
            this._showResults = false;
            this._searchText = '';
            this._searchResults = [];
            this.refreshUi();
        },

        search(text) {

            const self = this;

            console.log('searching for: ', text);
            self._searchText = text;

            if (!text) {
                self.clearSearch();
                return;
            }

            this._searchResults = [];
            self._searching = true;
            self._showResults = true;
            this.refreshUi();

            const hasSpecial = self._lunrSpecial.some(special => text.includes(special));
            const pattern =  hasSpecial 
                ? text
                : text + "*";

            console.log('lunr pattern: ', pattern);
            const localResults = self._lunrEngine.search(pattern);

            // NOTE: just for tests...
            // console.log('total result', localResults)

            // NOTE: highlighting
            localResults.forEach(localResult => {
                // NOTE: hard. ref.
                const data = self._lunrSearchData.find(i => i.url == localResult.ref);

                const highlight = {};

                for (let term in localResult.matchData.metadata) {
                    for (let field in localResult.matchData.metadata[term]) {

                        const positions = localResult.matchData.metadata[term][field].position;

                        const fieldValue = data[field];
                        let fieldReadIndex = 0;

                        highlight[field] = "";

                        for (let position of positions) {

                            if (position[0] > fieldReadIndex)
                                highlight[field] += fieldValue.substring(fieldReadIndex, position[0]);

                            highlight[field] += ("{:::" + fieldValue.substring(position[0], position[0] + position[1]) + ":::}");

                            fieldReadIndex = position[0] + position[1];

                        }

                        highlight[field] += fieldValue.substring(fieldReadIndex);             

                    }

                }

                for (let key in highlight) {
                    let value = highlight[key];

                    const encode = false;
                    let encoded = encode
                        ? he.encode(value)
                        : value;

                    let highlighted = encoded.replace(/{:::/g, '<mark>').replace(/:::}/g, '</mark>');
                    highlight[key] = highlighted;
                }

                localResult.ref = Object.assign({}, data, highlight);
            });

            self._searchResults = localResults;

            // finally
            self._searching = false;
            self.refreshUi();
        },

        _lunrSpecial: "*+-:^~".split(''),
        _lunrSearchData: undefined,
        _lunrEngine: undefined,

        init(inputSelector, cancelSelector, resultContainerSelector, containersToHideWhenResultSelector) {

            console.log('initializing search', this);

            // set up result / hide elements
            this._setUpContainers(resultContainerSelector, containersToHideWhenResultSelector);

            // refresh
            this.refreshUi();

            fetch(this._searchIndexPath).then((response) => {
                response.json().then((raw) => {

                    // set up engine, store search data
                    this._lunrSearchData = raw;

                    this._lunrEngine = lunr(function () {
                        this.ref('url')
                        this.field('title')
                        this.field('date')
                        this.field('author')
                        this.field('summary')
                        this.field('text')

                        this.metadataWhitelist = ['position']

                        raw.forEach(function (doc) { this.add(doc) }, this)
                    });

                    // set up UI listeners
                    this._debouncedSearch = new Debouncer((args) => this.search(args), this._debounceTime);
                    this._setUpListeners(inputSelector, cancelSelector);

                    // refresh
                    this.refreshUi();
                });
            });

        }

    };

    // NOTE:
    // #search-results-container must have an additional element with a .search-results class
    // these objects (along with #global-content-view) were already set up inside main.njk
    blogSearch.init('.blog-search-input', '.blog-search-cancel', '.search-results-container', '.hide-if-search-results-container-is-displayed');

</script>


        

        


        <!-- cookie consent dependent scripts and features -->
        
<!-- based on Jekyll - Chirpy + extension to support CC -->
<script defer src="https://www.googletagmanager.com/gtag/js?id=G-WF12VBK55W"></script>

<script>
    function loadGA(anonymizeIp) {

        console.log('loaging GA...')

        if (environment == "local") {
            console.log("...skipping GA on local!");
            return;
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }

            gtag('js', new Date());

            /*
            Note:
            Without an opt-in consent, we need to use anonymization.
            In general we should avoid collecting personal data.
            Here we can do the usual if/then branching if we still decide to collect personal data (yes, even a generated USER_ID or IP counts as such)!
      
            On the other hand, by using tools like Disqus, we need to notify user that:
            - cookies are used
            - and that 3rd party might store private data
            - ...but the user itself is in full control over those data - via the Disqus platform
            */
            options = {};

            if (anonymizeIp) options['anonymize_ip'] = true;

            gtag('config', 'G-WF12VBK55W', options);
        });
    }

    (function () {
        
        const consentRequired = !!true;
        const anonymizeIp = !!true;

        if (consentRequired == false) {
            loadGA(anonymizeIp);
        } else {
            switch (CookieConsent.getStatus()) {
                case CookieConsent.StatusEnum.enabled:
                    loadGA(anonymizeIp);
                    break;
                default:
                    // no consent given (or no answer ~ default) - we need to anonymize IP
                    loadGA(true);
                    break;
            }
        }
  
    })();
</script>


    </body>

    <!-- dynamic & custom scripts that need to run after the entire "final" content is rendered -->
    <script src="/assets/js/custom/d-hide-if-empty.js"></script>
    <script src="/assets/js/custom/sticky.js"></script>

    <!-- scripts from content pages -->
    

    <script src="/assets/js/custom/menu-path-and-scroll-spy.js"></script>

</html>
