<!DOCTYPE html>
<html lang="en-US" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="-1">

        <title>Designing Microservices the Right Way | Reflective Tech Consulting For Succesful Projects</title>
        <meta name="title" content="Designing Microservices the Right Way | Reflective Tech Consulting For Succesful Projects">
        <meta name="description" content="Helping others with useful content | posts, development, developers, junior-developers, management, teamlead, techlead, architecture, advanced SOA, CTO, Fractional, Fractional CTO, CTO as a Service, Leadership, Technical Leadership, Fractional Leadership, Affordable Tech Leadership, Affordable Technical Leadership, Strategy, Strategic Leadership, Consultation, Tech Consultation, Technical Consultation, Health Check, Precision Tech Audit, Due Diligence Code Audit, Outsourcing, Nearshoring, Offshoring, Vendor Management, Team Management, Team Mentoring, Entrepreneurs, CEOs, Founders, SMEs, Startups, Software Engineering, Boring Companies, Boring Technology, MVP, Minimum Viable Project, Procuct Market Fit, Software Architecture, Software Development, Tech Debt, Technical Debt, Programming Debt, Best Practices, Simple Approach, Near-to-zero Maintenance, SimplyPut Consulting">
        <meta name="keywords" content="posts, development, developers, junior-developers, management, teamlead, techlead, architecture, advanced SOA, CTO, Fractional, Fractional CTO, CTO as a Service, Leadership, Technical Leadership, Fractional Leadership, Affordable Tech Leadership, Affordable Technical Leadership, Strategy, Strategic Leadership, Consultation, Tech Consultation, Technical Consultation, Health Check, Precision Tech Audit, Due Diligence Code Audit, Outsourcing, Nearshoring, Offshoring, Vendor Management, Team Management, Team Mentoring, Entrepreneurs, CEOs, Founders, SMEs, Startups, Software Engineering, Boring Companies, Boring Technology, MVP, Minimum Viable Project, Procuct Market Fit, Software Architecture, Software Development, Tech Debt, Technical Debt, Programming Debt, Best Practices, Simple Approach, Near-to-zero Maintenance, SimplyPut Consulting">
        <meta name="author" content="Bal√°zs HIDEGH√âTY">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://reflectivetechconsulting.com//post/designing-microservices-the-right-way/">
        <link rel="shortcut icon" type="image/png" href="/assets/reflection logo.ico">
        
        <link rel="preconnect" href="cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="cdnjs.cloudflare.com">

        <link rel="preconnect" href="cdn.jsdelivr.net">
        <link rel="dns-prefetch" href="cdn.jsdelivr.net">

        <script src="/assets/js/custom/set-environment.js"></script>

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha256-MBffSnbbXwHCuZtgPYiwMQbfE7z+GOZ7fBPCNB06Z98=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha256-gvZPYrsDwbwYJLD5yeBfcNujPhRoGOY831wwbIzz3t0=" crossorigin="anonymous"></script>

        <script src="/assets/js/custom/clipboard-copy.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/ejs@3.1.6/ejs.min.js" integrity="sha256-mOsgtygNfXBUPc/+cc19yr+g0jieqYOgRL5xFD2sC0Y=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js" integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" integrity="sha512-PEsccDx9jqX6Dh4wZDCnWMaIO3gAaU0j46W//sSqQhUQxky6/eHZyeB3NrXD2xsyugAKd4KPiDANkcuoEa2JuA==" crossorigin="anonymous"></script>
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <link rel="stylesheet" href="/assets/css/main.css" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax.css" integrity="sha256-/a0I9OFWuIXZRhqSuqIj8g0NUYSID+mwuyOuuFZb12A=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax.min.js" integrity="sha256-uCknJLYMrtYTPwl8PwQnFj6T6Hck2oSGEZLhMi1BRvU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/jarallax@2.0.4/dist/jarallax-video.min.js" integrity="sha256-zYuE44YyKYv3Y4xv38UkxBY4jFCzAmAxwJ2nfRj16WI=" crossorigin="anonymous"></script>
        <script>
            function InitParallax() {
                jarallax(document.querySelectorAll('.jarallax'), {
                    speed: 0.2, 
                    disableVideo: /iPad|iPhone|iPod|Android/
                });
            }
        </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js" integrity="sha512-3J8teBiHrSyaaRBajZyIEtpDsXdPq1gsznKWIVb5CnorQuFhjWGhWe54z8YNnHHr7MZuExb9m5kvf964HiT1Sw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            function InitTyped() {
                // sample:
                // <span class="text-success">ever created for
                //   <span data-typed='{"strings": ["developers.", "founders.", "designers."]}'></span>
                //   <span class="typed-cursor typed-cursor--blink" aria-hidden="true">|</span>
                // </span>
                document.querySelectorAll("[data-typed]").forEach(e => {
                    const t = {
                        typeSpeed: 40,
                        backSpeed: 10,
                        backDelay: 2e3,
                        loop: true,
                        replaceBaseText : true, /* future feature */
                        autoInsertCss: true,
                        ...e.dataset.typed ? JSON.parse(e.dataset.typed) : {}
                    };

                    var typed = new Typed(e, t);
                });
            }         
        </script>

        
        <script src="https://cdn.jsdelivr.net/npm/wowjs@1.1.3/dist/wow.min.js" integrity="sha256-gHiUEskgBO+3ccSDRM+c5+nEwTGp64R99KYPfITpnuo=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" integrity="sha256-X7rrn44l1+AUO65h1LGALBbOc5C5bOstSYsNlv9MhT8=" crossorigin="anonymous">
        <script>
            function InitAOS() {
                new WOW({ animateClass: 'animate__animated' }).init();
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/@srexi/purecounterjs/dist/purecounter_vanilla.js"></script>
        <script>
            function InitCounters() {
                new PureCounter();
            }
        </script>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.2.0/dist/css/glightbox.min.css" integrity="sha256-bT9i1NF5afnHDpQ4z2cQBHJQGehoEj8uvClaAG+NXS0=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/glightbox@3.2.0/dist/js/glightbox.min.js" integrity="sha256-A9/h+86SqfF/zRoVASE72CDQUKsIXDOEGasGo2MclFk=" crossorigin="anonymous"></script>
        <script>
            function InitLightbox() {
                GLightbox({});
            }
        </script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.4/dist/tiny-slider.css">
        <script src="https://cdn.jsdelivr.net/npm/tiny-slider@2.9.4/dist/min/tiny-slider.min.js"></script>
        <style>
        
            .tns-nav {
                text-align: center;
                margin: 1em 0;
            }

            .tns-nav > [aria-controls] {
                width: .5em;
                height: .5em;
                padding: 0;
                margin: .5em .25em;                
                border: 0;
                border-radius: 50%;
                background: var(--bs-gray);
            }

            .tns-nav > .tns-nav-active { 
                background: var(--bs-gray-dark); 
            }

        </style>
        <!--
        Possibilities:
        - bootstrap carousel (1 item visible)
        - css carousel https://codepen.io/medrupaloscil/pen/OJNrLLX
        - vanilla JS: keen-slider, swiper, tiny-slider, glider
        - jQuery carousel: slick-carousel, glidejs
        -->
        <script>
            function InitCarousel(selector, options) {
                var carousel = tns({
                    container: selector,
                    ...options
                });
            }
        </script>
        
        
    </head>
    <body class="fit-height">

        <!-- cookie consent script -->
        <!--
NOTE:
    ConsentStatus.enabled is set if no cookie consent is required (globals.cookieConsent.required)...
    ...otherwise ConsentStatus.default is the default value until consent is not given or denied!
-->
<script>
    const CookieConsent = {

        StatusEnum: {
            "default": "default",
            "enabled": "enabled",
            "disabled": "disabled"
        },

        loadScripts: function (requireConsent, consentUrl) {
            if (requireConsent) {
                // scripts managed based on consent status
                this._initializeCookieConsent(consentUrl);
            } else {
                // all scripts enabled
                this._enableCookies();
            }
        },

        getStatus() {
            return localStorage.cookies ?? this.StatusEnum.default;
        },

        _setStatus(value) {
            const changed = this.getStatus() != value;
            localStorage.cookies = value;
            if (changed) window.location.reload();
        },

        _defaultCookies: function () {
            console.log('default cookies');
            this._setStatus(this.StatusEnum.default);
        },

        _enableCookies: function () {
            console.log('enabled cookies');
            this._setStatus(this.StatusEnum.enabled);
        },

        _disableCookies: function () {
            console.log('disabled cookies');
            this._setStatus(this.StatusEnum.disabled);
        },

        _initializeCookieConsent: function (consentUrl) {

            const me = this;

            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#aa0000",
                        "text": "#ffdddd"
                    },
                    "button": {
                        "background": "#ff0000"
                    }
                },
                "theme": "edgeless",
                "position": "bottom-right",
                "type": "opt-in",
                "content": {
                    "message": "This website uses cookies to ensure you get the best experience here.",
                    "href": consentUrl
                },

                onInitialise: function (status) {
                    console.log(`cc - onInitialise, status: ${status}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    
                    if (type == 'opt-in' && didConsent) {
                        me._enableCookies();
                    }
                    else if (type == 'opt-out' && !didConsent) {
                        me._disableCookies();
                    }
                    else {
                        me._defaultCookies();
                    }
                },

                onStatusChange: function (status, chosenBefore) {
                    console.log(`cc - onStatusChange, status: ${status}, chosenBefore: ${chosenBefore}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();

                    if (type == 'opt-in' && didConsent) {
                        me._enableCookies();
                    }
                    if (type == 'opt-out' && !didConsent) {
                        me._disableCookies();
                    }
                },

                onRevokeChoice: function () {
                    // NOTE: this hook is called immediately after the revoke button is clicked and removes previous answers
                    console.log(`cc - onRevokeChoice`);

                    var type = this.options.type;

                    if (type == 'opt-in') {
                        me._disableCookies();

                        // NOTE: we need to reload page, so that we get rid of the loaded GA / Disqus scripts!
                        location.reload();
                    }
                    if (type == 'opt-out') {
                        me._enableCookies();
                    }
                },

                onPopupOpen: function () {
                    console.log(`cc - onPopupOpen`);
                },

                onPopupClose: function () {
                    console.log(`cc - onPopupClose`);
                }

            });

        }

    };
</script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>
<script>
    const requireConsent = JSON.parse('true');
    const consentUrl = '/cookies.html';  
    CookieConsent.loadScripts(requireConsent, consentUrl);
</script>


        <header class="sticky-top">
            <nav id="navbar-main" class="navbar-main navbar navbar-expand-lg">

    <div class="container">

        <a class="navbar-brand d-flex align-items-center" href="/">
            <div class="d-flex flex-column">
                <img src="/assets/reflection logo.png" />
                <span class="navbar-brand-subtitle align-self-center">ReflectiveTechConsulting.Com</span>
            </div>
        </a>

        <div class="ms-auto mx-2"></div>

        <!-- standalone search bar activator (below navigation) -->
        <a type="button" role="button" class="btn border-0 me-2 d-lg-none"
            data-bs-toggle="collapse" data-bs-target="#blog-search-bar">
            <!-- d-sm-none = hide if above sm -->
            <i class="fa-solid fa-magnifying-glass"></i>
        </a>

        <button type="button" class="btn navbar-toggler"
            data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <!-- Using navbar-toggler fix in main.scss and FA icons instead of: <span class="navbar-toggler-icon"></span> -->
            <i class="fa-solid fa-bars"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarNavDropdown">

            <ul class="navbar-nav d-flex flex-row flex-wrap align-items-center bd-navbar-nav pt-2 py-sm-0 px-5 w-100">
               
                
                <!--
    The navigation menu should always use CURRENT www version links (for this there's no _v* segment) !
-->
<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link default p-2" href="/"><i class="fa-solid fa-house"></i></a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/services">Services</a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/projects">Projects & More</i></a>
</li>

<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/fcto">F-CTO</a>
</li>

<!--
<li class="nav-item col-6 col-lg-auto">
    <a class="nav-link p-2" href="/www/about-me">About Me</a>
</li>
-->

                <div class="ms-auto mx-2"></div>

                <li class="nav-item dropdown col-12 col-lg-auto">
                    <hr class="d-block d-lg-none" />
                    <a class="d-inline-flex nav-link p-2" href="/posts/1/">Posts</a>
                    <a class="d-inline-flex nav-link no-dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-bs-hover="dropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-angles-down"></i>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <li><a class="dropdown-item" href="/tags">Tags</a></li>
                        <li><a class="dropdown-item" href="/categories">Categories</a></li>
                        <li><a class="dropdown-item" href="/series">Series</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/tag-cloud">Tags cloud</a></li>
                    </ul>
                </li>      

            </ul>

        </div>

        <!-- inline search-bar with same expand breakpoint as navigation -->
        <nav class="nav-search d-none d-lg-inline">
            <!-- hidden by def., visible (block) aft. size SM -->
            <div class="inline-input-group inline-text-right">
                <span class="inline-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" class="blog-search-input form-control py-0" placeholder="Search...">
            </div>
        </nav>

    </div>

</nav>

<!-- 
standalone search bar (below navigation) with same breakpoint as navigation (shown on collapse)
d-sm-none = hide if above sm
-->
<nav class="nav-search-below d-lg-none collapse" id="blog-search-bar">
    <div class="container">
        <div class="p-3">
            <div class="inline-input-group inline-text-left">
                <span class="inline-text"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" class="blog-search-input form-control" placeholder="Search...">
            </div>
        </div>
    </div>
</nav>
        </header>

        <main>
            
            

    <div class="layout layout-post">
     
        <div class="content-container container">

            <div class="hide-if-search-results-container-is-displayed row">

                <section class="article-section col-12 col-xl-9 overflow-hidden">
               
                    <header></header>
                    <article>
                        

    
    
    
    <section class="d-flex justify-content-end align-items-center d-hide-if-empty">
        

<section class="share-wrapper">
    <span class="share-label text-body-secondary mr-1">Share post</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/designing-microservices-the-right-way/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fa-brands fa-linkedin fa-fw"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Share post&amp;url=/post/designing-microservices-the-right-way/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fa-brands fa-square-twitter fa-fw"></i>
                </a>
            
        
            
        
            
        
            
        
        
        <a href onclick="copyLink(); return false;" data-toggle="tooltip" data-placement="top" title="Copy link">
            <i class="fa-solid fa-link fa-fw small"></i>
        </a>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>


    </section>
    
    <section class="article print-container">

        <section>
            <h1>Designing Microservices the Right Way</h1>
            
            <p>This article is part of the serie: <a href="/serie/distributed-systems">distributed-systems</a></p>
            
            
        </section>
    
        <section class="taxonomy small d-xl-flex gap-3 pb-3">
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/categories"><i class="fa-regular fa-fw fa-folder-open text-body-secondary"></i></a>
    </div>
    <div class="d-inline-block">
        
        
        <a href="/category/newsletter/1/" class="me-1">
                
            Newsletter
            
        </a>
        
        
        <a href="/category/newsletter/architecture/1/" class="me-1">
                
            Newsletter
                
             - Architecture
            
        </a>
        
        
        <a href="/category/development/architecture/1/" class="me-1">
                
            Development
                
             - Architecture
            
        </a>
        
    </div>
</div>

<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/tags"><i class="fa-solid fa-fw fa-tags text-body-secondary"></i></a>
    </div>
    <div class="d-inline-block">
        
        <a href="/tag/posts/1/" class="me-1">posts</a>
        
        <a href="/tag/development/1/" class="me-1">development</a>
        
        <a href="/tag/developers/1/" class="me-1">developers</a>
        
        <a href="/tag/junior-developers/1/" class="me-1">junior-developers</a>
        
        <a href="/tag/management/1/" class="me-1">management</a>
        
        <a href="/tag/teamlead/1/" class="me-1">teamlead</a>
        
        <a href="/tag/techlead/1/" class="me-1">techlead</a>
        
        <a href="/tag/architecture/1/" class="me-1">architecture</a>
        
        <a href="/tag/advanced-soa/1/" class="me-1">advanced SOA</a>
        
    </div>
</div>
</section>

        <section class="small pb-3">
            <div><span class="text-body-secondary">Posted</span> Feb 26, 2024</div>
            <div class="d-xl-flex justify-content-start gap-3">
                <div><span class="text-body-secondary">By</span> Bal√°zs HIDEGH√âTY</div>
                <div class="ms-auto">4 min <span class="text-body-secondary">reading time</span></div>
            </div>
        </section>

        <hr class="m-1" />

        <section class="pb-3">
            <img class="img-thumbnail img-this d-block mx-auto float-md-start me-md-3 mb-md-1" src="/post/designing-microservices-the-right-way/erik - atelier lumier.png">
            <p><strong>Remember, business goals are rarely about having a top-notch system!</strong></p>
<p>Finally, we have arrived at the point where we can discuss the pinnacle of modern software architecture: <strong>microservices</strong>.</p>
<p>When it comes to designing a software system, it‚Äôs not easy. <strong>Designing microservices is even harder</strong>. And even if you do it right, there are situations where you will run into issues.</p>
<p>This is why I always suggest that before contemplating Microservices, <strong>one should always consider scaling up</strong>. Here‚Äôs my article on LinkedIn about <a href="https://www.linkedin.com/feed/update/urn:li:activity:7156296447221514240/">10 scaling-up possibilities before considering microservices</a> - also available <a href="/post/scaling-secrets-10-tips-every-ceo-should-know-before-resorting-to-microservices/">here</a>.</p>
<div class="clearfix"></div>
<hr/>
<p>Today‚Äôs lesson and the summary are based on these two great talks:</p>
<ul>
<li><a href="https://youtu.be/Fuac__g928E">Microservices and Rules Engines ‚Äì a Blast from the Past - Udi Dahan</a></li>
<li><a href="https://www.youtube.com/watch?v=gfh-VCTwMw8">Avoiding Microservice Megadisasters - Jimmy Bogard</a></li>
</ul>
<p>Let‚Äôs dive into the nuances and challenges of microservices‚Ä¶</p>
<p>Consider this summary article as a concise way to reinforce the main message: <strong>one should always consider scaling up first.</strong></p>
<h2 id="business-first" tabindex="-1">Business first</h2>
<blockquote>
<p>Remember, business goals are rarely about having a top-notch system!</p>
<p>We should aim for a decent one that‚Äôs easy to maintain, extend, and scale.</p>
</blockquote>
<p>The best example of how <strong>a simple approach can outperform a full-fledged system</strong> is demonstrated in a <a href="https://www.youtube.com/watch?v=gfh-VCTwMw8">Microservices-related conference by Jimmy Bogard</a>.</p>
<p>To achieve higher <strong>business goals</strong>, like increasing checkouts and paying customers, he opted to disable certain input validations (such as those on credit card numbers) and avoid blocking or frustrating users during checkout. Thus <strong>addressing any issues later via an in-person phone call proved more advantageous for the company</strong> than insisting on a top-notch form or system upfront, potentially resulting in losing clients.</p>
<h2 id="microservices-red-flags" tabindex="-1">Microservices RED FLAGS</h2>
<p>If you notice any of these signs, then you‚Äôre approaching microservices the wrong way:</p>
<ul>
<li>1Ô∏è‚É£ <strong>Unclear data ownership</strong>.</li>
<li>2Ô∏è‚É£ <strong>Shared data store</strong> (either directly through the database, indirectly via a REST layer on the database, or through other workarounds).</li>
<li>3Ô∏è‚É£ <strong>Excessive service dependencies</strong> - Cascading API calls beyond the gateway create complex dependencies and increase the risk of API hell and distributed deadlocks.</li>
<li>4Ô∏è‚É£ <strong>Replication via messaging</strong> - Volatile business logic data is duplicated through pub-sub mechanisms, indicating incorrect service boundaries and unclear service responsibilities.</li>
<li>5Ô∏è‚É£ <strong>Overly granular services</strong></li>
</ul>
<h2 id="what-to-know-when-designing-microservices" tabindex="-1">What to know when designing microservices</h2>
<p>It‚Äôs all about mindset. To do it right, we need to understand:</p>
<ol>
<li>The correct <strong>definition of a service</strong>, considering both their hosting and data aspects.</li>
<li><strong>The truth about coupling.</strong></li>
<li>The importance of service <strong>boundaries</strong> and data ownership.</li>
<li><strong>There are situations where microservices do not fit well</strong> (but that aspect is manageable as well).</li>
</ol>
<p>All these details are provided in the <a href="https://youtu.be/Fuac__g928E">main video</a>.</p>
<h2 id="where-microservices-come-short" tabindex="-1">Where microservices come short</h2>
<p>However, as your business needs become more intricate, such as with <strong>Rules Engines</strong>, you may encounter challenges with encapsulation.</p>
<p><strong>What are those business use cases?</strong> Here are some examples:</p>
<ul>
<li>Search (engine)</li>
<li>Pricing (engine)</li>
<li>Fraud detection (engine)</li>
</ul>
<p>In these instances, you require data from multiple services, and the temptation might be to simply send that data across! But please, refrain from doing so!</p>
<h2 id="microservices---major-takeaways" tabindex="-1">Microservices - Major takeaways</h2>
<p><strong>There are the major takeaways:</strong></p>
<ul>
<li><strong>coupling</strong> is a part of real life, so it is part of the code</li>
<li>we can‚Äôt remove top-to-bottom coupling, but <strong>we can remove side-by-side coupling</strong> (using micro frontends and UI composition)</li>
<li><strong>definition of: systems, services, unit of deployment‚Ä¶</strong></li>
<li><strong>services own their data</strong>, they should not share data (to other systems) that‚Äôs volatile</li>
</ul>
<p><strong>These are services:</strong></p>
<ul>
<li>product information</li>
<li>price information</li>
<li>inventory levels</li>
</ul>
<p><strong>But these aren‚Äôt:</strong></p>
<ul>
<li>search</li>
<li>pricing</li>
<li>fraud detection
‚Ä¶these are composite kinds of systems‚Ä¶</li>
</ul>
<p><strong>Search is challenging;</strong> Google has set high standards, leading to unrealistic expectations for searches conducted by small teams in a matter of weeks, in contrast to Google‚Äôs search engine developed by a team of 10,000 developers.</p>
<h2 id="how-we-solve-those-cross-cutting-services" tabindex="-1">How we solve those cross-cutting services</h2>
<p>‚Ä¶which needs data from everywhere?</p>
<p><strong>The <a href="http://bell.com">bell.com</a> case - duplicating data</strong></p>
<p>Sometimes, we can do it by duplicating data relevant to the search (redundant or limited data, that can be <strong>recreated</strong> at any time).</p>
<p>This type of dependency inversion is what Jimmy Bogard showcased in the 2nd linked video [^2] (but please keep in mind that that design choice was given by the existing system which they tried to fix)‚Ä¶</p>
<p>‚Ä¶or we can do it via <strong>composing components from services</strong></p>
<h2 id="the-hosting-(composing)-side-of-microservices" tabindex="-1">The hosting (composing) side of microservices</h2>
<!-- [Microservices and Rules Engines ‚Äì a blast from the past - Udi Dahan - YouTube](https://youtu.be/Fuac__g928E?t=1407) -->
<ul>
<li>We take ‚Äúparts‚Äù from different services, we arrange all them together on that platform (system)</li>
<li>The system does not really have its own code, all the code belong to the services.</li>
<li>The system does not really own any data, the data is owned by those services.</li>
</ul>
<p>This approach allows us to create these generic engines (systems)!</p>
<p><strong>‚Ä¶but introducing dependencies between systems implies the need for orchestrated deployments.</strong> Consequently, tools like Kubernetes become essential for managing and coordinating the deployment of these interdependent systems efficiently.</p>
<h2 id="the-data-side-of-microservices" tabindex="-1">The data side of microservices</h2>
<ul>
<li>The system (referenced previously in the hosting section) does not own the data.</li>
<li>The data is owned by the services.</li>
<li>The service doesn‚Äôt share that data; it doesn‚Äôt send it out to other microservices, neither through an API call nor via a shared database.</li>
<li>Even with pub-sub, ideally, you want to be sending nothing more than some identifiers.</li>
</ul>
<p>If you start sharing data that‚Äôs volatile, such as a price or an address, that‚Äôs when you start getting into trouble. Again, the issue here is not about how you share it but the fact that you‚Äôre sharing it in the first place.</p>
<h2 id="generic-engines" tabindex="-1">Generic engines</h2>
<h3 id="search-engine" tabindex="-1">Search engine</h3>
<p><strong>Search is not just about free-text search.</strong></p>
<p>Relevance matters as well (especially in the case of a huge amount of data).</p>
<ul>
<li>price</li>
<li>brand</li>
<li>color</li>
<li>‚Ä¶</li>
</ul>
<p><img src="/post/designing-microservices-the-right-way/generic search engine.png" class="w-100"></img></p>
<h3 id="pricing-engine" tabindex="-1">Pricing engine</h3>
<p>Same as search, <strong>customer specific pricing</strong> and <strong>fraud detection</strong> too will need access to multiple services, we will actually need to access specific classes implementing specific interfaces from those services.</p>
<p><img src="/post/designing-microservices-the-right-way/pricing engine.png" class="w-100"></img></p>
<h3 id="plug%E2%80%99n%E2%80%99-play" tabindex="-1">Plug‚Äôn‚Äô Play</h3>
<p><strong>Assembly-scanning gives plug-n-play</strong></p>
<p>At process startup, scan the runtime directory, load all assemblies, and scan types for those that implement a specific interface (IProvidePriceFactor, IProvideFraudMultiple, ‚Ä¶).</p>
<h2 id="outro" tabindex="-1">Outro</h2>
<p>Hopefully, with all these details, you will be able to develop your first microservice successfully and without mega-disasters‚Ä¶</p>
<p>But is that all? Well, not really. We talked about design, but there‚Äôs one challenge that still remains: managing the deployment (of physical service instances referred to previously as systems), where a single physical service instance can depend on multiple logical microservices.</p>
<hr>
<p>üìå Make sure you and your team subscribe (follow me) on <a href="https://www.linkedin.com/in/hideghety/" target="_blank" class="text-decoration-none"><i class="fa-brands fa-linkedin"></i>¬†LinkedIn</a> so you don‚Äôt miss out on the latest insights!</p>
<hr>

        </section>

    </section>
     

                    </article>
                    <div class="article-tail">
                        
    
    <hr class="m-1" />

    <section class="further-reading">
        <h5 class="text-body-secondary">Further Reading</h5>
        <div class="post-navigation related-posts dynamic-headings">
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/simple-api-integration-problems-and-patterns/"></a>

		<div class="card-body">

			<div class="card-text post-date">Feb 19, 2024</div>
			<div class="card-title post-title">Simple API - Integration Problems and Patterns</div>
			<div class="card-text post-content">
				<p>Even the simplest distributed system ‚Äì <span class="text-highlight">yes, even integrating against a single API ‚Äì can pose significant challenges</span> (more than 80% of solutions that SMEs have). <strong>Mind-blowing, right!?</strong></p>

			</div>
	
		</div>

	</div>	
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/distributed-system-design-and-fallacies/"></a>

		<div class="card-body">

			<div class="card-text post-date">Feb 12, 2024</div>
			<div class="card-title post-title">Distributed System Design and Fallacies</div>
			<div class="card-text post-content">
				<p>Distributed applications (APIs)? Avoid technical hiccups! <span class="text-highlight">Break free from misconceptions and build truly resilient distributed systems!</span></p>

			</div>
	
		</div>

	</div>	
    
	<div class="card post-preview">
		
		<a class="stretched-link" href="/post/6-little-lines-of-fail-everything-is-distributed/"></a>

		<div class="card-body">

			<div class="card-text post-date">Feb 05, 2024</div>
			<div class="card-title post-title">6 Little Lines of Fail - Everything is Distributed</div>
			<div class="card-text post-content">
				<p>In today's tech-driven world, <span class="text-highlight">even the simplest-looking code can wreak havoc if not handled by seasoned experts</span>. This's why technical experts are not just &quot;nice to have&quot; for companies, but a crucial ‚Ä¶</p>

			</div>
	
		</div>

	</div>	
    
</div>
        


<section class="post-navigation prev-next">
    <div class="btn-group btn-group-block d-flex">
        <a class="btn btn-sm btn-outline-secondary" prompt="Older" href="/post/the-critical-choice-picking-the-perfect-cto-archetype-for-your-business-startup/" title="The Critical Choice - Picking the Perfect CTO Archetype for Your Business / Startup"><div>The Critical Choice - Picking the Perfect CTO Archetype for Your Business / Startup</div></a>
        
        <a class="btn btn-sm btn-outline-primary" prompt="Newer" href="/post/simple-api-integration-problems-and-patterns/" title="Simple API - Integration Problems and Patterns"><div>Simple API - Integration Problems and Patterns</div></a>
        </div>
</section>

    </section>

    <section class="commenting d-hide-if-empty">
        
        

    </section>


                    </div>
                    <footer></footer>
                </section>

                <section class="aside-section d-none d-xl-flex col-xl-3">
                    <header></header>
                    <aside>

    <div class="sticky-container d-flex flex-column">

        <div non-sticky-heading></div>

        
        <section class="order-0 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Articles in Serie</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><ul class="aside-navigation series">

    <li>
        <span class="active">Designing Microservices the Right Way - distributed-systems</span>
    <li>
        <a href="/post/simple-api-integration-problems-and-patterns/">Simple API - Integration Problems and Patterns - distributed-systems</a></li>
    
    <li>
        <a href="/post/distributed-system-design-and-fallacies/">Distributed System Design and Fallacies - distributed-systems</a></li>
    
    <li>
        <a href="/post/6-little-lines-of-fail-everything-is-distributed/">6 Little Lines of Fail - Everything is Distributed - distributed-systems</a></li>
    
</ul></div>
</section>

        
        <section class="order-1 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Similar Articles</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><ul class="aside-navigation related-posts">
    
    <li>
        
        <a href="/post/simple-api-integration-problems-and-patterns/">
            <span>Simple API - Integration Problems and Patterns</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/distributed-system-design-and-fallacies/">
            <span>Distributed System Design and Fallacies</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/6-little-lines-of-fail-everything-is-distributed/">
            <span>6 Little Lines of Fail - Everything is Distributed</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/domain-driven-design-and-refactoring/">
            <span>Domain Driven Design and Refactoring</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/unit-testing-101/">
            <span>Unit Testing 101</span>
        </a>
    </li>
    
</ul></div>
</section>

        
        <section class="order-2 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Recent Posts</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div>
<ul class="recent-posts">
    
    <li>
        <a href="/post/designing-microservices-the-right-way/">
            <span>Designing Microservices the Right Way</span>
        </a>
    </li>
    
    <li>
        <a href="/post/simple-api-integration-problems-and-patterns/">
            <span>Simple API - Integration Problems and Patterns</span>
        </a>
    </li>
    
    <li>
        <a href="/post/distributed-system-design-and-fallacies/">
            <span>Distributed System Design and Fallacies</span>
        </a>
    </li>
    
    <li>
        <a href="/post/6-little-lines-of-fail-everything-is-distributed/">
            <span>6 Little Lines of Fail - Everything is Distributed</span>
        </a>
    </li>
    
    <li>
        <a href="/post/unit-testing-101/">
            <span>Unit Testing 101</span>
        </a>
    </li>
    
</ul></div>
</section>

        
        <section class="order-3 sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Tag Cloud</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><div class="ps-3">
 
    <span style="font-size: 0.9875em;">
        <a href="/tag/advanced-soa/1/">advanced SOA</a>
    </span>
 
    <span style="font-size: 1.05em;">
        <a href="/tag/architecture/1/">architecture</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/avoid-failures/1/">avoid-failures</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/ceos/1/">CEOs</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/chat/1/">chat</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/classification/1/">classification</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/ctos/1/">CTOs</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/developers/1/">developers</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/development/1/">development</a>
    </span>
 
    <span style="font-size: 1.05em;">
        <a href="/tag/efficiency/1/">efficiency</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/emails/1/">emails</a>
    </span>
 
    <span style="font-size: 1.2375em;">
        <a href="/tag/entrepreneurship/1/">entrepreneurship</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/founder/1/">founder</a>
    </span>
 
    <span style="font-size: 1.2375em;">
        <a href="/tag/founders/1/">founders</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/hr/1/">HR</a>
    </span>
 
    <span style="font-size: 1.2375em;">
        <a href="/tag/junior-developers/1/">junior-developers</a>
    </span>
 
    <span style="font-size: 0.925em;">
        <a href="/tag/linkedin/1/">linkedIn</a>
    </span>
 
    <span style="font-size: 1.55em;">
        <a href="/tag/management/1/">management</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/meetings/1/">meetings</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/microservices/1/">microservices</a>
    </span>
 
    <span style="font-size: 1.8em;">
        <a href="/tag/posts/1/">posts</a>
    </span>
 
    <span style="font-size: 0.925em;">
        <a href="/tag/productivity-hacks/1/">productivity-hacks</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/scaling/1/">scaling</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/smes/1/">SMEs</a>
    </span>
 
    <span style="font-size: 0.925em;">
        <a href="/tag/softwareengineering/1/">softwareengineering</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/startups/1/">startups</a>
    </span>
 
    <span style="font-size: 0.925em;">
        <a href="/tag/team-setup/1/">team-setup</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/teamlead/1/">teamlead</a>
    </span>
 
    <span style="font-size: 1.3em;">
        <a href="/tag/techlead/1/">techlead</a>
    </span>
 
    <span style="font-size: 0.925em;">
        <a href="/tag/tips/1/">tips</a>
    </span>

</div></div>
</section>

        
        <section class="order-first sticky p-3">
    <div class="heading">
        <div class="sticky-heading">Table of Contents</div>
        <a class="sticky-link"><i class="fa-solid fa-link"></i></a>
    </div>
    <div><div class="text-nowrap overflow-hidden"><nav class="toc">
                <ol>
                    
                    <li><a href="#business-first">Business first</a>
            		</li>

                    <li><a href="#microservices-red-flags">Microservices RED FLAGS</a>
            		</li>

                    <li><a href="#what-to-know-when-designing-microservices">What to know when designing microservices</a>
            		</li>

                    <li><a href="#where-microservices-come-short">Where microservices come short</a>
            		</li>

                    <li><a href="#microservices---major-takeaways">Microservices - Major takeaways</a>
            		</li>

                    <li><a href="#how-we-solve-those-cross-cutting-services">How we solve those cross-cutting services</a>
            		</li>

                    <li><a href="#the-hosting-(composing)-side-of-microservices">The hosting (composing) side of microservices</a>
            		</li>

                    <li><a href="#the-data-side-of-microservices">The data side of microservices</a>
            		</li>

                    <li><a href="#generic-engines">Generic engines</a>
            
                <ol>
                    
                    <li><a href="#search-engine">Search engine</a>
            		</li>

                    <li><a href="#pricing-engine">Pricing engine</a>
            		</li>

                    <li><a href="#plug%E2%80%99n%E2%80%99-play">Plug‚Äôn‚Äô Play</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#outro">Outro</a>
            		</li>
                </ol>
            </nav></div></div>
</section>

    </div>

</aside>
                    <footer></footer>
                </section>

            </div>

            <div class="hide-if-search-results-container-is-displayed row">
                <!-- Add tail here? Looks weird if aside content is long! -->
                
            </div>

            <div class="search-results-container row">
                <div class="search-results-wrapper overflow-hidden"></div>
            </div>

        </div>

    </div>


        </main>

	    <!-- dynamic & custom scripts to alter rendered content -->
        <script>

    /* uses:
    EJS.CO for templating
    LUNR for search
    HE for HTML encoding (at highlight fnc.)
    */
   
    class Debouncer {
        _timeoutId = undefined;
        _wait = 250;
        _callback;

        constructor(callback, wait) {
            this._wait = wait ? wait : this._wait;
            this._callback = callback;
        }

        next(...args) {
            this.cancel();
            this._timeoutId = window.setTimeout(() => {
            this._callback.apply(null, args);
            }, this._wait);
        }

        cancel() {
            window.clearTimeout(this._timeoutId);
        }
    }

    const blogSearch = {

        _searchIndexPath: '/search.json',
        _urlPrefix: '/',
        _debounceTime: 400,

        _searchingTemplate: `
<h2>
    <i class="fa-solid fa-circle-notch fa-spin text-secondary"></i>
    <span class="text-secondary">Searching for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>
`,

        _resultTemplate_simple: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<% if (searchResults.length == 0){ %>
    <span class="no-results">We're sorry, but we couldn't find any items that match your search. Please try again with different keywords or filters...</span>
<% } %>

<ul class="items-found">
<% searchResults.forEach((sr, idx, arr) => { %>
    <li>
        <div class="search-result-item position-relative border shadow">
            <h5><%- sr.ref.title %></h5>
            <p class="x-text-nowrap x-text-truncate"><%- sr.ref.summary %></p>
            <a href="<%- urlPrefix %><%- sr.ref.url %>" class="stretched-link"></a>
        </div>
    </li>
<% }); %>
</ul>        
`,

        _resultTemplate: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<% if (searchResults.length == 0){ %>
    <span class="no-results">We're sorry, but we couldn't find any items that match your search. Please try again with different keywords or filters...</span>
<% } %>

<ul class="search-results">
<% searchResults.forEach((sr, idx, arr) => { %>
    <li>

        <div class="catalogue-item position-relative">
            
            <a class="stretched-link" href="<%- urlPrefix %><%- sr.ref.url %>"></a>
            <h3 class="catalogue-title"><%- sr.ref.title %></h3>
            <div class="catalogue-line"></div>

            <div class="catalogue-preview clearfix">
                <% if (sr.ref.image) { %>
                <img src="<%- sr.ref.image %>" class="catalogue-image img-fluid img-thumbnail"></img>
                <% } %>
                <div class="excerpt">
                    <%- sr.ref.summary %>
                </div>
            </div>

        </div>

    </li>
<% }); %>
</ul>        
`,

        _inputElements: [],
        _cancelElements: [],
        
        _updateInputs(value) {
            this._inputElements.forEach(el => el.value = value);
        },

        _setUpListeners(inputSelector, cancelSelector) {
            if (inputSelector) {
                this._inputElements = document.querySelectorAll(inputSelector);
                this._inputElements.forEach(el => el.addEventListener('keyup', evt => { if (evt.keyCode == 27) this._escapePressed(el); else this._inputValueChanged(el); } ));
            } else {
                this._inputElements = [];
            }

            if (cancelSelector) {
                this._cancelElements = document.querySelectorAll(cancelSelector);
            } else {
                this._cancelElements = [];
            }
        },

        _escapePressed(el) {
            this.clearSearch();
        },

        _inputValueChanged(el) {
            const value = el.value;
            this._updateInputs(value);
            this._debouncedSearch.next(value);
        },

        _resultContainerEls: [],
        _containersToHideEls: [],

        _setUpContainers(resultContainerSelector, containersToHideWhenResultSelector) {
            this._resultContainerEls = document.querySelectorAll(resultContainerSelector);
            this._containersToHideEls = document.querySelectorAll(containersToHideWhenResultSelector);
        },

        _showResults: false,
        _searching: false,
        _searchText: '',
        _searchResults: [],

        refreshUi() {
            const self = this;

            self._inputElements.forEach(el => el.value = self._searchText );

            const html = self._showResults
                ? self._searching
                    ? ejs.render(self._searchingTemplate, { searchText: self._searchText })
                    : ejs.render(self._resultTemplate, { urlPrefix: self._urlPrefix.replace(/\/+$/, ''), searchText: self._searchText, searchResults: self._searchResults })
                : '';

            self._resultContainerEls.forEach(el => { 
                // hide/show container
                self._showResults ? el.classList.remove("d-none") : el.classList.add("d-none")
                
                // find results element (or fallback to container) and set results
                const resultsEl = el.querySelector(".search-results-wrapper");
                const displayEl = resultsEl ?? el;
                displayEl.innerHTML = self._showResults ? html : "";
            });

            self._containersToHideEls.forEach(el => self._showResults ? el.classList.add("d-none") : el.classList.remove("d-none"));          
        },

        clearSearch() {
            this._showResults = false;
            this._searchText = '';
            this._searchResults = [];
            this.refreshUi();
        },

        search(text) {

            const self = this;

            console.log('searching for: ', text);
            self._searchText = text;

            if (!text) {
                self.clearSearch();
                return;
            }

            this._searchResults = [];
            self._searching = true;
            self._showResults = true;
            this.refreshUi();

            const hasSpecial = self._lunrSpecial.some(special => text.includes(special));
            const pattern =  hasSpecial 
                ? text
                : text + "*";

            console.log('lunr pattern: ', pattern);
            const localResults = self._lunrEngine.search(pattern);

            // NOTE: just for tests...
            // console.log('total result', localResults)

            // NOTE: highlighting
            localResults.forEach(localResult => {
                // NOTE: hard. ref.
                const data = self._lunrSearchData.find(i => i.url == localResult.ref);

                const highlight = {};

                for (let term in localResult.matchData.metadata) {
                    for (let field in localResult.matchData.metadata[term]) {

                        const positions = localResult.matchData.metadata[term][field].position;

                        const fieldValue = data[field];
                        let fieldReadIndex = 0;

                        highlight[field] = "";

                        for (let position of positions) {

                            if (position[0] > fieldReadIndex)
                                highlight[field] += fieldValue.substring(fieldReadIndex, position[0]);

                            highlight[field] += ("{:::" + fieldValue.substring(position[0], position[0] + position[1]) + ":::}");

                            fieldReadIndex = position[0] + position[1];

                        }

                        highlight[field] += fieldValue.substring(fieldReadIndex);             

                    }

                }

                for (let key in highlight) {
                    let value = highlight[key];

                    const encode = false;
                    let encoded = encode
                        ? he.encode(value)
                        : value;

                    let highlighted = encoded.replace(/{:::/g, '<mark>').replace(/:::}/g, '</mark>');
                    highlight[key] = highlighted;
                }

                localResult.ref = Object.assign({}, data, highlight);
            });

            self._searchResults = localResults;

            // finally
            self._searching = false;
            self.refreshUi();
        },

        _lunrSpecial: "*+-:^~".split(''),
        _lunrSearchData: undefined,
        _lunrEngine: undefined,

        init(inputSelector, cancelSelector, resultContainerSelector, containersToHideWhenResultSelector) {

            console.log('initializing search', this);

            // set up result / hide elements
            this._setUpContainers(resultContainerSelector, containersToHideWhenResultSelector);

            // refresh
            this.refreshUi();

            fetch(this._searchIndexPath).then((response) => {
                response.json().then((raw) => {

                    // set up engine, store search data
                    this._lunrSearchData = raw;

                    this._lunrEngine = lunr(function () {
                        this.ref('url')
                        this.field('title')
                        this.field('date')
                        this.field('author')
                        this.field('summary')
                        this.field('text')

                        this.metadataWhitelist = ['position']

                        raw.forEach(function (doc) { this.add(doc) }, this)
                    });

                    // set up UI listeners
                    this._debouncedSearch = new Debouncer((args) => this.search(args), this._debounceTime);
                    this._setUpListeners(inputSelector, cancelSelector);

                    // refresh
                    this.refreshUi();
                });
            });

        }

    };

    // NOTE:
    // #search-results-container must have an additional element with a .search-results class
    // these objects (along with #global-content-view) were already set up inside main.njk
    blogSearch.init('.blog-search-input', '.blog-search-cancel', '.search-results-container', '.hide-if-search-results-container-is-displayed');

</script>


        

        


        <!-- cookie consent dependent scripts and features -->
        
<!-- based on Jekyll - Chirpy + extension to support CC -->
<script defer src="https://www.googletagmanager.com/gtag/js?id=G-WF12VBK55W"></script>

<script>
    function loadGA(anonymizeIp) {

        console.log('loaging GA...')

        if (environment == "local") {
            console.log("...skipping GA on local!");
            return;
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }

            gtag('js', new Date());

            /*
            Note:
            Without an opt-in consent, we need to use anonymization.
            In general we should avoid collecting personal data.
            Here we can do the usual if/then branching if we still decide to collect personal data (yes, even a generated USER_ID or IP counts as such)!
      
            On the other hand, by using tools like Disqus, we need to notify user that:
            - cookies are used
            - and that 3rd party might store private data
            - ...but the user itself is in full control over those data - via the Disqus platform
            */
            options = {};

            if (anonymizeIp) options['anonymize_ip'] = true;

            gtag('config', 'G-WF12VBK55W', options);
        });
    }

    (function () {
        
        const consentRequired = !!true;
        const anonymizeIp = !!true;

        if (consentRequired == false) {
            loadGA(anonymizeIp);
        } else {
            switch (CookieConsent.getStatus()) {
                case CookieConsent.StatusEnum.enabled:
                    loadGA(anonymizeIp);
                    break;
                default:
                    // no consent given (or no answer ~ default) - we need to anonymize IP
                    loadGA(true);
                    break;
            }
        }
  
    })();
</script>


    </body>

    <!-- dynamic & custom scripts that need to run after the entire "final" content is rendered -->
    <script src="/assets/js/custom/d-hide-if-empty.js"></script>
    <script src="/assets/js/custom/sticky.js"></script>

    <!-- scripts from content pages -->
    

    <script src="/assets/js/custom/menu-path-and-scroll-spy.js"></script>

</html>
